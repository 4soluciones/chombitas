

<style>
    .text-rotated-90{
        transform: rotate(180deg);
        white-space: nowrap;
        writing-mode: vertical-rl;
        padding: 0;
        line-height: 0.9;
    }
</style>



<table class="table table-sm table-bordered" id="excel-data-grid">
    <thead>
    <tr>
        <td class="align-middle text-center table-info" rowspan="2">FECHA</td>

            <td class="text-center font-weight-bold" colspan="5">10KG</td>
            <td class="table-warning text-center" colspan="{{ header_b10|length }}">PRECIOS</td>
        <td class="align-middle text-center table-info" rowspan="2"><span class="text-rotated-90">TOTAL<br/>VENTA S/</span></td>
            <td class="text-center table-dark text-white" colspan="7">FIERROS</td>

            <td class="text-center font-weight-bold" colspan="5">5KG</td>
            <td class="table-warning text-center" colspan="{{ header_b5|length }}">PRECIOS</td>
        <td class="align-middle text-center table-info" rowspan="2"><span class="text-rotated-90">TOTAL<br/>VENTA S/</span></td>
            <td class="text-center table-dark text-white" colspan="7">FIERROS</td>

            <td class="text-center font-weight-bold" colspan="5">45KG</td>
            <td class="table-warning text-center" colspan="{{ header_b45|length }}">PRECIOS</td>
        <td class="align-middle text-center table-info" rowspan="2"><span class="text-rotated-90">TOTAL<br/>VENTA S/</span></td>
            <td class="text-center table-dark text-white" colspan="7">FIERROS</td>

            <td class="text-center font-weight-bold" colspan="5">15KG</td>
            <td class="table-warning text-center" colspan="{{ header_b15|length }}">PRECIOS</td>
        <td class="align-middle text-center table-info" rowspan="2"><span class="text-rotated-90">TOTAL<br/>VENTA S/</span></td>
            <td class="text-center table-dark text-white" colspan="7">FIERROS</td>

        <td class="align-middle text-center table-info  font-weight-bold" rowspan="2"><span class="text-rotated-90">TOTAL<br/>VENTA DEL<br/>DIA S/</span></td>

        <td class="text-center" colspan="5">GASTOS</td>
        <td class="align-middle text-center table-danger  font-weight-bold" rowspan="2"><span class="text-rotated-90">TOTAL<br/>DEPOSITAR S/</span></td>
            <td class="text-center" colspan="6">MOVIMIENTO DE EFECTIVO</td>
        <td class="align-middle text-center table-secondary  font-weight-bold" rowspan="2"><span class="text-rotated-90">TOTAL POR<br/>DEPOSITAR <br/>ACUMULADO S/</span></td>

    </tr>
    <tr>
            <td class="align-middle text-center"><span class="text-rotated-90">LLENO</span></td>
            <td class="align-middle text-center"><span class="text-rotated-90">VACIO</span></td>
            <td class="align-middle text-center"><span class="text-rotated-90">CAMBIOS</span></td>
            <td class="align-middle text-center table-success"><span class="text-rotated-90">VENTA</span></td>
            <td class="align-middle text-center table-primary"><span class="text-rotated-90">QUEDA<br/>LLENOS</span></td>
            {% for pb10 in header_b10 %}
                <td class="align-middle text-center table-warning"><span class="text-rotated-90">{{ pb10|safe }}</span></td>
            {% empty %}
                <td class="align-middle text-center table-warning"></td>
            {% endfor %}
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">QUEDA<br/>VACIOS</span></td>
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">PRESTADOS</span></td>
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">RECUPERADOS<br/>EN REPARTO</span></td>
            <td class="align-middle text-center table-dark text-danger"><span class="text-rotated-90">RECUPERADOS<br/>EN PLANTA</span></td>
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">ADELANTADOS</span></td>
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">VENDIDOS<br/>(PAGADOS)</span></td>
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">DEBE<br/>FIERROS</span></td>


            <td class="align-middle text-center"><span class="text-rotated-90">LLENO</span></td>
            <td class="align-middle text-center"><span class="text-rotated-90">VACIO</span></td>
            <td class="align-middle text-center"><span class="text-rotated-90">CAMBIOS</span></td>
            <td class="align-middle text-center table-success"><span class="text-rotated-90">VENTA</span></td>
            <td class="align-middle text-center table-primary"><span class="text-rotated-90">QUEDA<br/>LLENOS</span></td>
            {% for pb5 in header_b5 %}
                <td class="align-middle text-center table-warning"><span class="text-rotated-90">{{ pb5|safe }}</span></td>
            {% empty %}
                <td class="align-middle text-center table-warning"></td>
            {% endfor %}
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">QUEDA<br/>VACIOS</span></td>
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">PRESTADOS</span></td>
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">RECUPERADOS<br/>EN REPARTO</span></td>
            <td class="align-middle text-center table-dark text-danger"><span class="text-rotated-90">RECUPERADOS<br/>EN PLANTA</span></td>
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">ADELANTADOS</span></td>
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">VENDIDOS<br/>(PAGADOS)</span></td>
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">DEBE<br/>FIERROS</span></td>


            <td class="align-middle text-center"><span class="text-rotated-90">LLENO</span></td>
            <td class="align-middle text-center"><span class="text-rotated-90">VACIO</span></td>
            <td class="align-middle text-center"><span class="text-rotated-90">CAMBIOS</span></td>
            <td class="align-middle text-center table-success"><span class="text-rotated-90">VENTA</span></td>
            <td class="align-middle text-center table-primary"><span class="text-rotated-90">QUEDA<br/>LLENOS</span></td>
            {% for pb45 in header_b45 %}
                <td class="align-middle text-center table-warning"><span class="text-rotated-90">{{ pb45|safe }}</span></td>
            {% empty %}
                <td class="align-middle text-center table-warning"></td>
            {% endfor %}
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">QUEDA<br/>VACIOS</span></td>
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">PRESTADOS</span></td>
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">RECUPERADOS<br/>EN REPARTO</span></td>
            <td class="align-middle text-center table-dark text-danger"><span class="text-rotated-90">RECUPERADOS<br/>EN PLANTA</span></td>
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">ADELANTADOS</span></td>
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">VENDIDOS<br/>(PAGADOS)</span></td>
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">DEBE<br/>FIERROS</span></td>

            <td class="align-middle text-center"><span class="text-rotated-90">LLENO</span></td>
            <td class="align-middle text-center"><span class="text-rotated-90">VACIO</span></td>
            <td class="align-middle text-center"><span class="text-rotated-90">CAMBIOS</span></td>
            <td class="align-middle text-center table-success"><span class="text-rotated-90">VENTA</span></td>
            <td class="align-middle text-center table-primary"><span class="text-rotated-90">QUEDA<br/>LLENOS</span></td>
            {% for pb15 in header_b15 %}
                <td class="align-middle text-center table-warning"><span class="text-rotated-90">{{ pb15|safe }}</span></td>
            {% empty %}
                <td class="align-middle text-center table-warning"></td>
            {% endfor %}
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">QUEDA<br/>VACIOS</span></td>
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">PRESTADOS</span></td>
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">RECUPERADOS<br/>EN REPARTO</span></td>
            <td class="align-middle text-center table-dark text-danger"><span class="text-rotated-90">RECUPERADOS<br/>EN PLANTA</span></td>
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">ADELANTADOS</span></td>
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">VENDIDOS<br/>(PAGADOS)</span></td>
            <td class="align-middle text-center table-dark text-white"><span class="text-rotated-90">DEBE<br/>FIERROS</span></td>

            <td class="align-middle text-center"><span class="text-rotated-90">PETROLEO</span></td>
            <td class="align-middle text-center"><span class="text-rotated-90">VIATICO</span></td>
            <td class="align-middle text-center"><span class="text-rotated-90">FERIADO Y SUELDO</span></td>
            <td class="align-middle text-center"><span class="text-rotated-90">MANTENIMIENTO</span></td>
            <td class="align-middle text-center"><span class="text-rotated-90">OTROS GASTOS</span></td>

            <td class="align-middle text-center"><span class="text-rotated-90">DEPOSITO<br/>Y/O<br/>EFECTIVO</span></td>
            <td class="align-middle text-center"><span class="text-rotated-90">SALDO</span></td>
            <td class="align-middle text-center"><span class="text-rotated-90">ENT. BANC</span></td>
            <td class="align-middle text-center"><span class="text-rotated-90">COD. OPE</span></td>
            <td class="align-middle text-center"><span class="text-rotated-90">FECHA</span></td>
            <td class="align-middle text-center"><span class="text-rotated-90 text-primary font-weight-bold">REVISADO</span></td>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="align-middle text-center table-info">SALDO</td>

        <td colspan="3"></td>
        <td class="align-middle text-center table-success"></td>
        <td class="align-middle text-center table-primary">{{ initial_remaining_in_the_car_bg10 }}</td>
        <td class="align-middle text-center table-warning" colspan="{{ header_b10|length }}"></td>
        <td class="align-middle text-center table-info"></td>
        <td class="table-dark text-center text-white">{{ initial_remaining_in_the_car_b10 }}</td>
        <td class="table-dark text-center text-white">{% if user_id == 5 %}{{ initial_debt_for_borrowed_balls_b10 }}{% endif %}</td>
        <td class="table-dark text-white">{% if user_id == 5 %}{{ initial_recovered_in_distribution_b10 }}{% endif %}</td>
        <td class="table-dark text-center text-danger">{% if user_id == 5 %}{{ initial_recovered_in_plant_b10 }}{% endif %}</td>
        <td class="table-dark text-white"></td>
        <td class="table-dark text-white"></td>
        <td class="table-dark text-white">
            {% if initial_remaining_borrowed_b10 and initial_remaining_in_the_car_b10 %}
                {{ initial_remaining_borrowed_b10|add:initial_remaining_in_the_car_b10 }}
            {% else %}
                N/A
            {% endif %}
        </td>

        <td colspan="3"></td>
        <td class="align-middle text-center table-success"></td>
        <td class="align-middle text-center table-primary">{{ initial_remaining_in_the_car_bg5 }}</td>
        <td class="align-middle text-center table-warning" colspan="{{ header_b5|length }}"></td>
        <td class="align-middle text-center table-info"></td>
        <td class="table-dark text-center text-white">{{ initial_remaining_in_the_car_b5 }}</td>
        <td class="table-dark text-center text-white">{% if user_id == 5 %}{{ initial_debt_for_borrowed_balls_b5 }}{% endif %}</td>
        <td class="table-dark text-white">{% if user_id == 5 %}{{ initial_recovered_in_distribution_b5 }}{% endif %}</td>
        <td class="table-dark text-center text-danger">{% if user_id == 5 %}{{ initial_recovered_in_plant_b5 }}{% endif %}</td>
        <td class="table-dark text-white"></td>
        <td class="table-dark text-white"></td>
        <td class="table-dark text-white">
            {% if initial_remaining_borrowed_b5 and initial_remaining_in_the_car_b5 %}
                {{ initial_remaining_borrowed_b5|add:initial_remaining_in_the_car_b5 }}
            {% else %}
                N/A
            {% endif %}
        </td>

        <td colspan="3"></td>
        <td class="align-middle text-center table-success"></td>
        <td class="align-middle text-center table-primary">{{ initial_remaining_in_the_car_bg45 }}</td>
        <td class="align-middle text-center table-warning" colspan="{{ header_b45|length }}"></td>
        <td class="align-middle text-center table-info"></td>
        <td class="table-dark text-center text-white">{{ initial_remaining_in_the_car_b45 }}</td>
        <td class="table-dark text-center text-white">{% if user_id == 5 %}{{ initial_debt_for_borrowed_balls_b45 }}{% endif %}</td>
        <td class="table-dark text-white">{% if user_id == 5 %}{{ initial_recovered_in_distribution_b45 }}{% endif %}</td>
        <td class="table-dark text-center text-danger">{% if user_id == 5 %}{{ initial_recovered_in_plant_b45 }}{% endif %}</td>
        <td class="table-dark text-white"></td>
        <td class="table-dark text-white"></td>
        <td class="table-dark text-white">
            {% if initial_remaining_borrowed_b45 and initial_remaining_in_the_car_b45 %}
                {{ initial_remaining_borrowed_b45|add:initial_remaining_in_the_car_b45 }}
            {% else %}
                N/A
            {% endif %}
        </td>

        <td colspan="3"></td>
        <td class="align-middle text-center table-success"></td>
        <td class="align-middle text-center table-primary">{{ initial_remaining_in_the_car_bg15 }}</td>
        <td class="align-middle text-center table-warning" colspan="{{ header_b15|length }}"></td>
        <td class="align-middle text-center table-info"></td>
        <td class="table-dark text-center text-white">{{ initial_remaining_in_the_car_b15 }}</td>
        <td class="table-dark text-center text-white">{% if user_id == 5 %}{{ initial_debt_for_borrowed_balls_b15 }}{% endif %}</td>
        <td class="table-dark text-white">{% if user_id == 5 %}{{ initial_recovered_in_distribution_b15 }}{% endif %}</td>
        <td class="table-dark text-center text-danger">{% if user_id == 5 %}{{ initial_recovered_in_plant_b15 }}{% endif %}</td>
        <td class="table-dark text-white"></td>
        <td class="table-dark text-white"></td>
        <td class="table-dark text-white">
            {% if initial_remaining_borrowed_b15 and initial_remaining_in_the_car_b15 %}
                {{ initial_remaining_borrowed_b15|add:initial_remaining_in_the_car_b15 }}
            {% else %}
                N/A
            {% endif %}
        </td>

        <td class="align-middle text-center table-info"></td>
        <td colspan="5"></td>
        <td class="align-middle text-center table-danger"></td>
        <td colspan="6"></td>
        <td class="align-middle text-center table-secondary font-weight-bold"></td>
    </tr>

{% for distribution in distributions %}

    <tr>
        <td class="align-middle text-center text-nowrap table-info">
            <button type="button" value="{{ distribution.id }}" class="btn btn-sm px-1 py-0 distribution-summary" data-toggle="modal" data-target="#staticBackdrop">{{ distribution.date }}</button>
{#            {{ distribution.id }}#}

{#            {% for id in distribution.ids %}<button type="button" value="{{ id }}" class="btn btn-link px-1 py-0 distribution-summary" data-toggle="modal" data-target="#staticBackdrop">{{ id }}</button>{% endfor %}#}
        </td>

        <td class="align-middle text-center">{{ distribution.B10.extracted_bg }}</td>
        <td class="align-middle text-center">{{ distribution.B10.returned_b }}</td>
        <td class="align-middle text-center">{{ distribution.B10.ruined_returned_bg }}</td>
        <td class="align-middle text-center table-success">{{ distribution.B10.quantity_sold }}</td>
        <td class="align-middle text-center table-primary">{{ distribution.B10.in_the_car_bg }}</td>

        {% for key, value in distribution.B10.prices.items  %}
            <td class="align-middle text-center table-warning">{{ value.quantity }}</td>
        {% endfor %}

        <td class="align-middle text-center table-info">{{ distribution.B10.total_sales }}</td>
        <td class="align-middle table-dark text-center text-white">{{ distribution.B10.in_the_car_b }}</td>
        <td class="align-middle table-dark text-white">{{ distribution.B10.quantity_sold_b }}</td>
        <td class="align-middle table-dark text-center text-white">{{ distribution.B10.recovered_b }}</td>
        <td class="align-middle table-dark text-center text-danger">{{ distribution.B10.recovered_in_plant_b }}</td>
        <td class="align-middle table-dark text-white">{{ distribution.B10.advanced_b }}</td>
        <td class="align-middle table-dark text-white">{{ distribution.B10.payed_in_plant_b }}</td>
        <td class="align-middle table-dark text-white">{{ distribution.B10.remaining_borrowed_b }}</td>

        <td class="align-middle text-center">{{ distribution.B5.extracted_bg }}</td>
        <td class="align-middle text-center">{{ distribution.B5.returned_b }}</td>
        <td class="align-middle text-center">{{ distribution.B5.ruined_returned_bg }}</td>
        <td class="align-middle text-center table-success">{{ distribution.B5.quantity_sold }}</td>
        <td class="align-middle text-center table-primary">{{ distribution.B5.in_the_car_bg }}</td>
        {% for key, value in distribution.B5.prices.items  %}
            <td class="align-middle text-center table-warning">{{ value.quantity }}</td>
        {% endfor %}
        <td class="align-middle text-center table-info">{{ distribution.B5.total_sales }}</td>
        <td class="align-middle table-dark text-center text-white">{{ distribution.B5.in_the_car_b }}</td>
        <td class="align-middle table-dark text-white">{{ distribution.B5.quantity_sold_b }}</td>
        <td class="align-middle table-dark text-center text-white">{{ distribution.B5.recovered_b }}</td>
        <td class="align-middle table-dark text-center text-danger">{{ distribution.B5.recovered_in_plant_b }}</td>
        <td class="align-middle table-dark text-white">{{ distribution.B5.advanced_b }}</td>
        <td class="align-middle table-dark text-white">{{ distribution.B5.payed_in_plant_b }}</td>
        <td class="align-middle table-dark text-white">{{ distribution.B5.remaining_borrowed_b }}</td>

        <td class="align-middle text-center">{{ distribution.B45.extracted_bg }}</td>
        <td class="align-middle text-center">{{ distribution.B45.returned_b }}</td>
        <td class="align-middle text-center">{{ distribution.B45.ruined_returned_bg }}</td>
        <td class="align-middle text-center table-success">{{ distribution.B45.quantity_sold }}</td>
        <td class="align-middle text-center table-primary">{{ distribution.B45.in_the_car_bg }}</td>
        {% for key, value in distribution.B45.prices.items  %}
            <td class="align-middle text-center table-warning">{{ value.quantity }}</td>
        {% endfor %}
        <td class="align-middle text-center table-info">{{ distribution.B45.total_sales }}</td>
        <td class="align-middle table-dark text-center text-white">{{ distribution.B45.in_the_car_b }}</td>
        <td class="align-middle table-dark text-white">{{ distribution.B45.quantity_sold_b }}</td>
        <td class="align-middle table-dark text-center text-white">{{ distribution.B45.recovered_b }}</td>
        <td class="align-middle table-dark text-center text-danger">{{ distribution.B45.recovered_in_plant_b }}</td>
        <td class="align-middle table-dark text-white">{{ distribution.B45.advanced_b }}</td>
        <td class="align-middle table-dark text-white">{{ distribution.B45.payed_in_plant_b }}</td>
        <td class="align-middle table-dark text-white">{{ distribution.B45.remaining_borrowed_b }}</td>

        <td class="align-middle text-center">{{ distribution.B15.extracted_bg }}</td>
        <td class="align-middle text-center">{{ distribution.B15.returned_b }}</td>
        <td class="align-middle text-center">{{ distribution.B15.ruined_returned_bg }}</td>
        <td class="align-middle text-center table-success">{{ distribution.B15.quantity_sold }}</td>
        <td class="align-middle text-center table-primary">{{ distribution.B15.in_the_car_bg }}</td>
        {% for key, value in distribution.B15.prices.items  %}
            <td class="align-middle text-center table-warning">{{ value.quantity }}</td>
        {% endfor %}
        <td class="align-middle text-center table-info">{{ distribution.B15.total_sales }}</td>
        <td class="align-middle table-dark text-center text-white">{{ distribution.B15.in_the_car_b }}</td>
        <td class="align-middle table-dark text-white">{{ distribution.B15.quantity_sold_b }}</td>
        <td class="align-middle table-dark text-center text-white">{{ distribution.B15.recovered_b }}</td>
        <td class="align-middle table-dark text-center text-danger">{{ distribution.B15.recovered_in_plant_b }}</td>
        <td class="align-middle table-dark text-white">{{ distribution.B15.advanced_b }}</td>
        <td class="align-middle table-dark text-white">{{ distribution.B15.payed_in_plant_b }}</td>
        <td class="align-middle table-dark text-white">{{ distribution.B15.remaining_borrowed_b }}</td>

        <td class="align-middle text-center table-info font-weight-bold">{{ distribution.total_sold_by_date }}</td>

        <td class="align-middle text-nowrap">{{ distribution.expense_1 }}</td>
        <td class="align-middle text-nowrap">{{ distribution.expense_2 }}</td>
        <td class="align-middle text-nowrap">{{ distribution.expense_3 }}</td>
        <td class="align-middle text-nowrap">{{ distribution.expense_4 }}</td>
        <td class="align-middle text-nowrap">
            {% for oe in distribution.other_expenses %}

<button type="button" class="btn btn-light" data-toggle="tooltip" data-placement="top" title="{{ oe }}">
  {{ distribution.expense_5 }}
</button>
            {% endfor %}

        </td>

        <td class="align-middle text-center table-danger font-weight-bold">{{ distribution.total_to_deposit }}</td>

        <td class="align-middle text-nowrap">{{ distribution.deposited }}</td>
        <td class="align-middle text-nowrap">{{ distribution.balance }}</td>
        <td class="align-middle text-nowrap">{{ distribution.bank }}</td>
        <td class="align-middle text-nowrap">{{ distribution.code_deposit }}</td>
        <td class="align-middle text-nowrap">{{ distribution.date_deposit }}</td>
        <td class="align-middle text-nowrap is-revised" >{% if distribution.deposit_set %}{{ distribution.deposit_set }}{% endif %}</td>
        <td class="align-middle text-center table-secondary font-weight-bold">{{ distribution.remaining_total_to_deposit }}</td>

    </tr>
{% endfor %}

    </tbody>
</table>
<script>

    $('table#excel-data-grid tbody tr').each(function (i){
        let cell = $(this).find('td.is-revised');
        const jsonString = cell.text().trim();
        if(jsonString!=='[]' && jsonString!==''){

            const cleanedString = jsonString.replace(/'/g, '"').replaceAll('False', 'false').replaceAll('True', 'true').replaceAll('None', 'null');
            const dataObject = JSON.parse(cleanedString);

            if(dataObject.length>0){
                let strHtml = '';
                for(let d = 0; d < dataObject.length; ++d){
                    strHtml +=`<div class="custom-control custom-checkbox"><input type="checkbox" ${dataObject[d]["revised"]?"checked":""} value="${dataObject[d]["id"]}" class="custom-control-input" id="customCheck${dataObject[d]["id"]}" /><label class="custom-control-label" for="customCheck${dataObject[d]["id"]}">${dataObject[d]["total"]}</label></div>`;
                }
                cell.html(strHtml);
            }

        }


    });

    $('table#excel-data-grid tbody tr td.is-revised input[type="checkbox"]').change(function(){
        if ($(this).is(":checked")) {
            checkedPay($(this).val(), true)
        } else {
            checkedPay($(this).val(), false)
        }
    });

    function checkedPay(cashFlowId, revised) {

            $.ajax({
                url: '/comercial/check_deposit_of_distribution/',
                async: true,
                dataType: 'json',
                type: 'GET',
                data: {
                    'cashFlowId': cashFlowId,
                    'revised': revised?1:0,
                },
                success: function (response) {
                    console.log(response.message)
                },
                fail: function (response) {
                    console.log("error");
                }
            });
        }
</script>